<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>For Mut Mut ‚Äî A Little Website of Love ‚ù§Ô∏è</title>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600;800&family=Dancing+Script:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --bg1: #ffdde1;
        --bg2: #fff1f8;
        --accent: #ff5c8a;
        --accent-2: #ff8ab3;
        --deep: #6b1b44;
        --card: rgba(255, 255, 255, 0.8);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: "Montserrat", system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial;
        background: radial-gradient(circle at 10% 20%, var(--bg1), var(--bg2));
        color: var(--deep);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
      }

      /* Container */
      .card {
        width: min(980px, 96vw);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.75),
          rgba(255, 255, 255, 0.9)
        );
        border-radius: 18px;
        padding: 28px;
        box-shadow: 0 10px 30px rgba(107, 27, 68, 0.12);
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.6);
      }

      header {
        display: flex;
        align-items: center;
        gap: 18px;
        margin-bottom: 14px;
      }
      .logo {
        width: 76px;
        height: 76px;
        border-radius: 16px;
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 800;
        font-family: "Dancing Script", "Montserrat";
        font-size: 28px;
        box-shadow: 0 6px 20px rgba(255, 92, 138, 0.25);
        border: 4px solid rgba(255, 255, 255, 0.12);
      }

      h1 {
        margin: 0;
        font-family: "Dancing Script", "Montserrat";
        font-size: 28px;
        line-height: 1.05;
        color: var(--deep);
      }
      p.lead {
        margin: 4px 0 0;
        color: #6b2a46;
        opacity: 0.95;
        font-size: 14px;
      }

      main {
        display: grid;
        grid-template-columns: 1fr 360px;
        gap: 18px;
        margin-top: 18px;
      }
      @media (max-width: 900px) {
        main {
          grid-template-columns: 1fr;
        }
        .sidebar {
          order: 2;
        }
      }

      /* Left: big love area */
      .hero {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.6),
          rgba(255, 255, 255, 0.4)
        );
        padding: 18px;
        border-radius: 12px;
        position: relative;
        min-height: 320px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        justify-content: center;
        align-items: flex-start;
        overflow: visible;
      }

      .typewriter {
        font-size: 20px;
        color: var(--deep);
        min-height: 52px;
      }
      .sub {
        font-size: 14px;
        color: #6b2a46;
        opacity: 0.92;
      }

      /* Heart button */
      .love-row {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      .big-heart {
        display: inline-grid;
        place-items: center;
        width: 110px;
        height: 110px;
        border-radius: 28px;
        background: linear-gradient(
            135deg,
            #fff 0%,
            rgba(255, 255, 255, 0.4) 100%
          ),
          radial-gradient(
            circle at 30% 20%,
            rgba(255, 255, 255, 0.15),
            transparent 40%
          ),
          linear-gradient(135deg, var(--accent), var(--accent-2));
        color: white;
        font-size: 28px;
        cursor: pointer;
        box-shadow: 0 12px 30px rgba(255, 92, 138, 0.28),
          0 3px 8px rgba(0, 0, 0, 0.06);
        border: 3px solid rgba(255, 255, 255, 0.2);
        transform-origin: center;
        transition: transform 0.18s ease, box-shadow 0.18s ease;
        user-select: none;
      }
      .big-heart:active {
        transform: translateY(3px) scale(0.98);
      }
      .big-heart .heart {
        font-size: 48px;
        filter: drop-shadow(0 6px 10px rgba(255, 92, 138, 0.18));
      }

      /* Little details */
      .notes {
        margin-top: 8px;
        background: var(--card);
        border-radius: 10px;
        padding: 10px;
        width: 100%;
      }
      .notes textarea {
        width: 100%;
        min-height: 86px;
        border: 0;
        resize: vertical;
        background: transparent;
        color: var(--deep);
        font-size: 14px;
        outline: none;
        font-family: inherit;
      }
      .actions {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-top: 8px;
      }
      button.btn {
        border: 0;
        padding: 10px 12px;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        color: white;
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        box-shadow: 0 6px 16px rgba(255, 92, 138, 0.18);
      }
      button.ghost {
        background: transparent;
        color: var(--deep);
        border: 1px solid rgba(107, 27, 68, 0.08);
        font-weight: 600;
        box-shadow: none;
      }

      /* Sidebar */
      .sidebar {
        position: relative;
        padding: 16px;
        border-radius: 12px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.85),
          rgba(255, 255, 255, 0.75)
        );
        border: 1px solid rgba(255, 255, 255, 0.6);
        min-height: 320px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
        justify-content: flex-start;
      }

      .small-title {
        font-size: 13px;
        color: #6b2a46;
        font-weight: 700;
      }
      .stat-grid {
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: space-between;
      }
      .stat {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.95),
          rgba(255, 255, 255, 0.82)
        );
        border-radius: 10px;
        padding: 10px;
        text-align: center;
        flex: 1;
        box-shadow: 0 6px 14px rgba(107, 27, 68, 0.04);
      }
      .stat strong {
        display: block;
        font-size: 18px;
        color: var(--accent);
      }

      /* Photo gallery */
      .gallery {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin-top: 6px;
      }
      .photo {
        background: linear-gradient(180deg, #fff, #fff0);
        border-radius: 8px;
        height: 72px;
        display: block;
        overflow: hidden;
        position: relative;
        border: 1px solid rgba(255, 92, 138, 0.08);
      }
      .photo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      /* little hearts floating */
      .floating-heart {
        position: absolute;
        width: 20px;
        height: 20px;
        transform: translate(-50%, -50%);
        pointer-events: none;
        opacity: 0.95;
        will-change: transform, opacity;
        animation: floatUp 2.6s ease-in forwards;
        filter: drop-shadow(0 6px 10px rgba(107, 27, 68, 0.12));
      }
      @keyframes floatUp {
        0% {
          transform: translateY(0) scale(0.6);
          opacity: 1;
        }
        100% {
          transform: translateY(-140px) scale(1.05);
          opacity: 0;
        }
      }

      footer {
        margin-top: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
        color: #7a3b5a;
        font-size: 13px;
      }

      /* Confetti canvas sits on top */
      #confetti {
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 40;
      }

      /* small helper */
      .muttag {
        display: inline-block;
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(255, 92, 138, 0.12);
        color: var(--accent);
        font-weight: 700;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <div class="card" role="main" aria-labelledby="forMut">
      <canvas id="confetti"></canvas>

      <header>
        <div class="logo" aria-hidden="true">üíå</div>
        <div>
          <h1 id="forMut">For Mut Mut ‚Äî My Sweetheart</h1>
          <p class="lead">
            A little surprise made with love ‚Äî click the heart, read a note, and
            giggle. ‚ù§Ô∏è
          </p>
        </div>
        <div style="margin-left: auto; text-align: right">
          <div class="muttag" aria-hidden="true">Mut Mut</div>
          <div style="font-size: 12px; color: #7a3b5a; margin-top: 6px">
            Made with ‚ô•
          </div>
        </div>
      </header>

      <main>
        <section class="hero" aria-label="Main love section">
          <div class="typewriter" id="greeting" aria-live="polite"></div>
          <div class="sub">
            You are the sparkle in my day. Press the heart to see something
            special ‚ú®
          </div>

          <div class="love-row">
            <button
              class="big-heart"
              id="loveBtn"
              aria-pressed="false"
              aria-label="Press to send love"
            >
              <div class="heart">üíñ</div>
              <div style="font-size: 12px; margin-top: 6px">For Mut Mut</div>
            </button>

            <div style="flex: 1">
              <div class="notes">
                <textarea
                  id="noteInput"
                  placeholder="Write a short note for Mut Mut ‚Äî it will appear as a surprise!"
                  aria-label="Write your note"
                >
To my dearest Mut Mut ‚Äî every moment with you is my favorite. ‚Äî Love</textarea
                >
                <div class="actions">
                  <button class="btn" id="saveNote">Save & Surprise üíå</button>
                  <button class="btn ghost" id="clearNote">Clear</button>
                </div>
              </div>
            </div>
          </div>

          <div
            style="margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap"
          >
            <button class="btn ghost" id="playAudio">Play Soft Chime üîî</button>
            <button class="btn ghost" id="toggleHearts">
              Make it Rain Hearts
            </button>
          </div>

          <div id="surpriseArea" style="margin-top: 12px"></div>
        </section>

        <aside class="sidebar" aria-label="Sidebar">
          <div>
            <div class="small-title">Little stats</div>
            <div class="stat-grid" style="margin-top: 10px">
              <div class="stat">
                <strong id="days">0</strong><span>days since we met</span>
              </div>
              <div class="stat">
                <strong id="smiles">‚àû</strong><span>smiles given</span>
              </div>
              <div class="stat">
                <strong id="kisses">xoxo</strong><span>kisses promised</span>
              </div>
            </div>
          </div>

          <div>
            <div class="small-title">Photos</div>
            <div class="gallery" id="gallery">
              <!-- Replace src with real photos. Use same size images for best result -->
              <a class="photo" href="#" tabindex="0" aria-label="Photo 1"
                ><img
                  src="https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=800&auto=format&fit=crop&s=1"
                  alt="Sweet photo 1"
              /></a>
              <a class="photo" href="#" tabindex="0" aria-label="Photo 2"
                ><img
                  src="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=800&auto=format&fit=crop&s=2"
                  alt="Sweet photo 2"
              /></a>
              <a class="photo" href="#" tabindex="0" aria-label="Photo 3"
                ><img
                  src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?q=80&w=800&auto=format&fit=crop&s=3"
                  alt="Sweet photo 3"
              /></a>
            </div>
          </div>

          <div>
            <div class="small-title">Little extras</div>
            <p style="margin: 6px 0 0; font-size: 13px; color: #7a3b5a">
              Click the photos to view. Change them to your favorites in the
              HTML.
            </p>
          </div>

          <div style="margin-top: auto">
            <button class="btn" id="downloadNote">Download Note ‚ú®</button>
          </div>
        </aside>
      </main>

      <footer>
        <div>
          Made especially for Mut Mut ‚Äî with <span aria-hidden="true">‚ù§Ô∏è</span>
        </div>
        <div style="opacity: 0.9">
          Tip: edit the <code>noteInput</code> or photos to personalize.
        </div>
        <div id="ytPlayer" style="display: none"></div>
      </footer>
    </div>
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
      /**********************
       * Helper: Typewriter
       **********************/
      const greetingEl = document.getElementById("greeting");
      const name = "Mut Mut"; // change if you want
      const lines = [
        `Hey ${name}...`,
        "I made this little website just for you.",
        "Click the heart ‚Äî I promise you'll smile. üíï",
      ];
      async function typeLines(target, arr, speed = 36, pause = 700) {
        target.textContent = "";
        for (let i = 0; i < arr.length; i++) {
          const s = arr[i];
          for (let c = 0; c < s.length; c++) {
            target.textContent += s[c];
            await new Promise((r) => setTimeout(r, speed));
          }
          if (i < arr.length - 1) {
            await new Promise((r) => setTimeout(r, pause));
            target.textContent += "\n";
          }
        }
      }
      // Start typing (no blocking)
      typeLines(greetingEl, lines, 32, 650);

      /**********************
       * Floating hearts
       **********************/
      const card = document.querySelector(".card");
      let heartsOn = false;
      document.getElementById("toggleHearts").addEventListener("click", () => {
        heartsOn = !heartsOn;
        if (heartsOn) {
          spawnHearts(12);
        } else {
          // remove existing ones
          document
            .querySelectorAll(".floating-heart")
            .forEach((h) => h.remove());
        }
      });

      function spawnHearts(count = 6) {
        for (let i = 0; i < count; i++) {
          const el = document.createElement("div");
          el.className = "floating-heart";
          el.style.left = 20 + Math.random() * 80 + "%";
          el.style.top = 60 + Math.random() * 30 + "%";
          el.style.fontSize = 12 + Math.random() * 22 + "px";
          el.style.transitionDelay = i * 80 + "ms";
          el.innerHTML = ["üíñ", "üíó", "üíï", "‚ù£Ô∏è"][
            Math.floor(Math.random() * 4)
          ];
          card.appendChild(el);
          // remove after animation
          setTimeout(() => el.remove(), 2600 + Math.random() * 800);
        }
        // if toggled remain, spawn again
        if (heartsOn)
          setTimeout(
            () => spawnHearts(Math.max(4, Math.floor(Math.random() * 10))),
            800 + Math.random() * 1000
          );
      }

      /**********************
       * Save & surprise note
       **********************/
      const noteInput = document.getElementById("noteInput");
      const saveBtn = document.getElementById("saveNote");
      const surpriseArea = document.getElementById("surpriseArea");

      saveBtn.addEventListener("click", () => {
        const txt = (
          noteInput.value || "I love you to the moon and back."
        ).trim();
        surpriseArea.innerHTML = "";
        // little card
        const card = document.createElement("div");
        card.style.padding = "12px";
        card.style.borderRadius = "10px";
        card.style.background =
          "linear-gradient(90deg, rgba(255,255,255,0.85), rgba(255,248,250,0.75))";
        card.style.border = "1px solid rgba(255,92,138,0.08)";
        card.style.boxShadow = "0 10px 30px rgba(107,27,68,0.06)";
        card.innerHTML = `<strong style="display:block;color:var(--accent);font-size:14px">A sweet note for Mut Mut</strong>
                              <p style="margin:8px 0 0;white-space:pre-wrap">${escapeHtml(
                                txt
                              )}</p>
                              <div style="margin-top:8px"><button class="btn" id="openPopup">Open Surprise üéÅ</button></div>`;

        surpriseArea.appendChild(card);

        document.getElementById("openPopup").addEventListener("click", () => {
          showPopup(txt);
        });

        // small feedback animation on the big heart
        animateHeartPulse();
      });

      document
        .getElementById("clearNote")
        .addEventListener("click", () => (noteInput.value = ""));

      function escapeHtml(s) {
        return s
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;");
      }

      /**********************
       * Heart button -> confetti + popup
       **********************/
      const loveBtn = document.getElementById("loveBtn");
      loveBtn.addEventListener("click", async () => {
        // toggle aria
        const pressed = loveBtn.getAttribute("aria-pressed") === "true";
        loveBtn.setAttribute("aria-pressed", (!pressed).toString());

        // tiny pulse
        loveBtn.animate(
          [
            { transform: "scale(1)" },
            { transform: "scale(1.06)" },
            { transform: "scale(0.98)" },
            { transform: "scale(1)" },
          ],
          { duration: 420, easing: "ease-out" }
        );

        // spawn hearts
        spawnHearts(18);
        // confetti
        fireConfetti(40);

        // show a small popup with the saved note
        const txt = (
          noteInput.value || "I love you to the moon and back."
        ).trim();
        showPopup(txt);
      });

      function animateHeartPulse() {
        loveBtn.animate(
          [
            { transform: "scale(1)" },
            { transform: "scale(1.05)" },
            { transform: "scale(0.98)" },
            { transform: "scale(1)" },
          ],
          { duration: 420, easing: "cubic-bezier(.25,.8,.25,1)" }
        );
      }

      /**********************
       * Popup modal (simple)
       **********************/
      function showPopup(message) {
        const overlay = document.createElement("div");
        overlay.style.position = "fixed";
        overlay.style.inset = "0";
        overlay.style.display = "grid";
        overlay.style.placeItems = "center";
        overlay.style.background = "rgba(10,8,12,0.45)";
        overlay.style.zIndex = 120;
        overlay.addEventListener("click", () => overlay.remove());

        const box = document.createElement("div");
        box.style.maxWidth = "520px";
        box.style.width = "92%";
        box.style.padding = "18px";
        box.style.borderRadius = "12px";
        box.style.background = "linear-gradient(180deg,#fff,#fffefc)";
        box.style.boxShadow = "0 20px 60px rgba(11,8,12,0.32)";
        box.style.border = "1px solid rgba(255,92,138,0.06)";
        box.addEventListener("click", (e) => e.stopPropagation());

        box.innerHTML = `<div style="display:flex;gap:12px;align-items:center">
                <div style="font-size:36px">üíù</div>
                <div style="flex:1">
                  <strong style="font-size:18px;color:var(--accent)">A little love for Mut Mut</strong>
                  <div style="font-size:13px;color:#6b2a46;margin-top:6px">Read this slowly, like a hug.</div>
                </div>
              </div>
              <div style="margin-top:12px;font-size:15px;color:#5b273b;white-space:pre-wrap">${escapeHtml(
                message
              )}</div>
              <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:14px">
                <button class="btn" id="closePopup">Close</button>
              </div>`;

        overlay.appendChild(box);
        document.body.appendChild(overlay);

        overlay
          .querySelector("#closePopup")
          .addEventListener("click", () => overlay.remove());
      }
      /**********************
       * YouTube Music Player + Soft Chime
       **********************/
      let player;
      let isPlaying = false;

      // Load YouTube player
      function onYouTubeIframeAPIReady() {
        player = new YT.Player("ytPlayer", {
          height: "0",
          width: "0",
          videoId: "kPhpHvnnn0Q", // ‚ù§Ô∏è Ed Sheeran - Perfect
          playerVars: {
            autoplay: 0, // browsers may block autoplay
            controls: 0,
          },
          events: {
            onReady: () => {
              console.log("YouTube player ready");
            },
          },
        });
      }

      const playAudioBtn = document.getElementById("playAudio");
      playAudioBtn.textContent = "Play Music üé∂";

      /**********************
       * Soft Chime Function
       **********************/
      function playChime() {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "sine";
        o.frequency.value = 520;
        g.gain.value = 0;
        o.connect(g);
        g.connect(ctx.destination);
        o.start();
        // envelope
        g.gain.linearRampToValueAtTime(0.001, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.08, ctx.currentTime + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 1.2);
        // sweep
        o.frequency.exponentialRampToValueAtTime(110, ctx.currentTime + 1.0);
        setTimeout(() => {
          o.stop();
          ctx.close();
        }, 1400);
      }

      /**********************
       * Button Behavior
       **********************/
      // Replace your playAudioBtn click event with this:

      let musicStarted = false;

      document.addEventListener("mousemove", () => {
        if (musicStarted || !player) return; // only start once + wait until YouTube is ready
        musicStarted = true;

        // Play soft chime first
        playChime();

        // Then play YouTube after ~1.5s delay
        setTimeout(() => {
          player.playVideo();
          player.unMute();
          isPlaying = true;
          playAudioBtn.textContent = "Pause Music ‚è∏Ô∏è";
        }, 1500);
      });

      /**********************
       * Download note as txt
       **********************/
      document.getElementById("downloadNote").addEventListener("click", () => {
        const text = noteInput.value || `To ${name},\n\nI love you.\n`;
        const blob = new Blob([text], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `note-for-${name.replace(/\s+/g, "-").toLowerCase()}.txt`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      });

      /**********************
       * Gallery click behavior
       **********************/
      document.getElementById("gallery").addEventListener("click", (ev) => {
        const a = ev.target.closest("a.photo");
        if (!a) return;
        ev.preventDefault();
        // open image in new tab (or show popup)
        const img = a.querySelector("img");
        if (img) window.open(img.src, "_blank");
      });

      /**********************
       * Days since a date (example date can be edited)
       **********************/
      function daysSince(year, month, day) {
        const start = new Date(year, month - 1, day);
        const now = new Date();
        const diff = now - start;
        return Math.floor(diff / (1000 * 60 * 60 * 24));
      }
      // Example: change to your anniversary date
      const anniversary = { y: 2024, m: 3, d: 6 }; // edit this
      document.getElementById("days").textContent = daysSince(
        anniversary.y,
        anniversary.m,
        anniversary.d
      );

      /**********************
       * Confetti (simple hearts + circles)
       * Small self-contained confetti system that uses canvas.
       **********************/
      const confettiCanvas = document.getElementById("confetti");
      const ctx = confettiCanvas.getContext("2d");
      let W = (confettiCanvas.width = confettiCanvas.clientWidth);
      let H = (confettiCanvas.height = confettiCanvas.clientHeight);
      window.addEventListener("resize", () => {
        W = confettiCanvas.width = confettiCanvas.clientWidth;
        H = confettiCanvas.height = confettiCanvas.clientHeight;
      });

      let confettiPieces = [];
      function fireConfetti(count = 30) {
        const colors = ["#FF5C8A", "#FFD1E0", "#FF8AB3", "#FFD9E6", "#FF9CCF"];
        for (let i = 0; i < count; i++) {
          confettiPieces.push({
            x: Math.random() * W,
            y: -10 - Math.random() * 60,
            vx: (Math.random() - 0.5) * 2.2,
            vy: 1 + Math.random() * 3,
            size: 6 + Math.random() * 10,
            rot: Math.random() * 360,
            velRot: (Math.random() - 0.5) * 6,
            life: 80 + Math.random() * 40,
            color: colors[Math.floor(Math.random() * colors.length)],
            shape: Math.random() > 0.6 ? "heart" : "circle",
          });
        }
        // animate (loop if not already)
        if (!confettiAnimating) {
          confettiAnimating = true;
          requestAnimationFrame(confettiLoop);
        }
      }

      let confettiAnimating = false;
      function confettiLoop() {
        ctx.clearRect(0, 0, W, H);
        for (let i = confettiPieces.length - 1; i >= 0; i--) {
          const p = confettiPieces[i];
          p.x += p.vx;
          p.y += p.vy;
          p.vy += 0.06; // gravity
          p.rot += p.velRot;
          p.life--;
          // draw
          ctx.save();
          ctx.globalAlpha = Math.max(0, Math.min(1, p.life / 120));
          ctx.translate(p.x, p.y);
          ctx.rotate((p.rot * Math.PI) / 180);
          if (p.shape === "circle") {
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(0, 0, p.size * 0.55, 0, Math.PI * 2);
            ctx.fill();
          } else {
            // heart path
            ctx.fillStyle = p.color;
            const s = p.size * 0.12;
            ctx.beginPath();
            ctx.moveTo(0, -p.size * 0.7 * s * 10);
            ctx.bezierCurveTo(
              p.size * s * 2,
              -p.size * s * 3,
              p.size * s * 4,
              p.size * s * 1.2,
              0,
              p.size * s * 4.5
            );
            ctx.bezierCurveTo(
              -p.size * s * 4,
              p.size * s * 1.2,
              -p.size * s * 2,
              -p.size * s * 3,
              0,
              -p.size * s * 6
            );
            ctx.closePath();
            ctx.fill();
          }
          ctx.restore();

          if (p.y > H + 80 || p.x < -80 || p.x > W + 80 || p.life <= 0) {
            confettiPieces.splice(i, 1);
          }
        }
        if (confettiPieces.length > 0) requestAnimationFrame(confettiLoop);
        else confettiAnimating = false;
      }

      // Make sure canvas overlays properly sized on load
      setTimeout(() => {
        W = confettiCanvas.width = confettiCanvas.clientWidth;
        H = confettiCanvas.height = confettiCanvas.clientHeight;
      }, 200);

      /**********************
       * End of script
       **********************/
    </script>
  </body>
</html>
